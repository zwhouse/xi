var xi =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/ui/main.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/game/adviser.ts":
/*!*****************************!*\
  !*** ./src/game/adviser.ts ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Adviser = /** @class */ (function (_super) {\n    __extends(Adviser, _super);\n    function Adviser(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    Adviser.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up, direction_1.Direction.Left);\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up, direction_1.Direction.Right);\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down, direction_1.Direction.Left);\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down, direction_1.Direction.Right);\n        return squares\n            .filter(function (x) { return x.isInOwnCastle(position.getPiece().color); })\n            .filter(function (x) { return !x.isOccupied() || x.getPiece().color !== position.getPiece().color; });\n    };\n    return Adviser;\n}(piece_1.Piece));\nexports.Adviser = Adviser;\n\n\n//# sourceURL=webpack://xi/./src/game/adviser.ts?");

/***/ }),

/***/ "./src/game/board.ts":
/*!***************************!*\
  !*** ./src/game/board.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar square_1 = __webpack_require__(/*! ./square */ \"./src/game/square.ts\");\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar move_1 = __webpack_require__(/*! ./move */ \"./src/game/move.ts\");\nvar color_1 = __webpack_require__(/*! ./color */ \"./src/game/color.ts\");\nvar soldier_1 = __webpack_require__(/*! ./soldier */ \"./src/game/soldier.ts\");\nvar cannon_1 = __webpack_require__(/*! ./cannon */ \"./src/game/cannon.ts\");\nvar rook_1 = __webpack_require__(/*! ./rook */ \"./src/game/rook.ts\");\nvar horse_1 = __webpack_require__(/*! ./horse */ \"./src/game/horse.ts\");\nvar elephant_1 = __webpack_require__(/*! ./elephant */ \"./src/game/elephant.ts\");\nvar adviser_1 = __webpack_require__(/*! ./adviser */ \"./src/game/adviser.ts\");\nvar general_1 = __webpack_require__(/*! ./general */ \"./src/game/general.ts\");\nvar Board = /** @class */ (function () {\n    function Board(state) {\n        this.grid = [];\n        this.moves = [];\n        this.capturedPieces = { \"red\": [], \"black\": [] };\n        this.init(state || Board.beginState);\n    }\n    Board.prototype.makeMoves = function (moves, isTryOuMove) {\n        if (isTryOuMove === void 0) { isTryOuMove = false; }\n        for (var _i = 0, moves_1 = moves; _i < moves_1.length; _i++) {\n            var move = moves_1[_i];\n            this.makeMove(move_1.Move.create(move, this), isTryOuMove);\n        }\n    };\n    Board.prototype.makeMove = function (move, isTryOuMove) {\n        if (isTryOuMove === void 0) { isTryOuMove = false; }\n        if (!move.from.isOccupied())\n            throw new Error(\"from square is not occupied\");\n        if (move.from.getPiece().color !== this.getTurn())\n            throw new Error(\"it's not \" + move.from.getPiece().color + \"'s turn\");\n        if (move.from.isColor(move.to.getPiece().color))\n            throw new Error(\"cannot capture own piece\");\n        var attacking = move.from.getPiece().getAttackingSquares(move.from);\n        if (attacking.indexOf(move.to) < 0)\n            throw new Error(\"illegal move\");\n        move.captured = move.to.setPiece(move.from.getPiece());\n        move.from.setPiece(piece_1.No.piece);\n        if (this.isCheck(this.getTurn())) {\n            // Cannot self-check: undo the move\n            move.from.setPiece(move.to.getPiece());\n            move.to.setPiece(move.captured);\n            throw new Error(\"cannot self check\");\n        }\n        if (isTryOuMove) {\n            move.from.setPiece(move.to.getPiece());\n            move.to.setPiece(move.captured);\n            return;\n        }\n        if (move.captured.color !== color_1.Color.None) {\n            this.capturedPieces[\"\" + move.captured.color].push(move.captured);\n        }\n        this.moves.push(move);\n    };\n    Board.prototype.popMove = function () {\n        if (this.moves.length === 0) {\n            throw new Error(\"no moves made yet\");\n        }\n        var lastMove = this.moves.pop();\n        lastMove.from.setPiece(lastMove.to.getPiece());\n        lastMove.to.setPiece(lastMove.captured);\n        if (lastMove.captured !== piece_1.No.piece) {\n            this.capturedPieces[\"\" + lastMove.captured.color].pop();\n        }\n        return lastMove;\n    };\n    Board.prototype.isCheckmate = function (color) {\n        var occupiedSquares = this.findOccupiedSquares(color);\n        for (var _i = 0, occupiedSquares_1 = occupiedSquares; _i < occupiedSquares_1.length; _i++) {\n            var occupiedSquare = occupiedSquares_1[_i];\n            var attackingSquares = occupiedSquare.getPiece().getAttackingSquares(occupiedSquare);\n            for (var _a = 0, attackingSquares_1 = attackingSquares; _a < attackingSquares_1.length; _a++) {\n                var attackingSquare = attackingSquares_1[_a];\n                // If `makeMove(...)` doesn't throw an error, it means `color` can\n                // make a valid move and is therefor not checkmate\n                try {\n                    this.makeMove(new move_1.Move(occupiedSquare, attackingSquare), true);\n                    return false;\n                }\n                catch (e) { }\n            }\n        }\n        return true;\n    };\n    Board.prototype.isCheck = function (color) {\n        if (this.areGeneralsLookingAtEachOther()) {\n            // Regardless of the color, this is always check\n            return true;\n        }\n        var generalSquare = this.findGeneral(color);\n        var otherSquares = [];\n        var otherAttackingSquares = [];\n        // Find all square occupied by `Color.opposite(color)`\n        for (var _i = 0, _a = this.grid; _i < _a.length; _i++) {\n            var row = _a[_i];\n            for (var _b = 0, row_1 = row; _b < row_1.length; _b++) {\n                var square = row_1[_b];\n                if (square.isOccupied() && square.isColor(color_1.Color.opposite(color))) {\n                    otherSquares.push(square);\n                }\n            }\n        }\n        // Find all squares being attacked by `Color.opposite(color)`\n        for (var _c = 0, otherSquares_1 = otherSquares; _c < otherSquares_1.length; _c++) {\n            var square = otherSquares_1[_c];\n            otherAttackingSquares = otherAttackingSquares.concat(square.getPiece().getAttackingSquares(square));\n        }\n        // If the `generalSquare` is part of `otherAttackingSquares`, then `color` is check\n        return otherAttackingSquares.indexOf(generalSquare) >= 0;\n    };\n    Board.prototype.areGeneralsLookingAtEachOther = function () {\n        var redGeneralSquare = this.findGeneral(color_1.Color.Red);\n        var blackGeneralSquare = this.findGeneral(color_1.Color.Black);\n        if (redGeneralSquare.x !== blackGeneralSquare.x) {\n            return false;\n        }\n        // Inspect all squares between the 2 generals\n        for (var y = blackGeneralSquare.y + 1; y < redGeneralSquare.y; y++) {\n            if (this.getSquare(blackGeneralSquare.x, y).isOccupied()) {\n                // If there's 1 occupied, the generals can't be facing each other\n                return false;\n            }\n        }\n        return true;\n    };\n    Board.prototype.getTurn = function () {\n        return this.moves.length === 0 || this.moves.length % 2 === 0 ? color_1.Color.Red : color_1.Color.Black;\n    };\n    Board.prototype.isTurn = function (color) {\n        return this.getTurn() === color;\n    };\n    Board.prototype.getCapturedPieces = function (color) {\n        return this.capturedPieces[\"\" + color];\n    };\n    Board.prototype.getSquare = function (x, y) {\n        if (y < 0 || y >= this.grid.length || x < 0 || x >= this.grid[0].length) {\n            throw new Error(\"index out of bounds: \" + x + \", \" + y);\n        }\n        return this.grid[y][x];\n    };\n    Board.prototype.toString = function () {\n        var str = \"\";\n        for (var y = 0; y < this.grid.length; y++) {\n            for (var x = 0; x < this.grid[y].length; x++) {\n                str += this.grid[y][x].getPiece().toString() + \" \";\n            }\n            str += \"\\n\";\n        }\n        return str;\n    };\n    Board.createPiece = function (char) {\n        switch (char.toLowerCase()) {\n            case \"s\": return new soldier_1.Soldier(char);\n            case \"c\": return new cannon_1.Cannon(char);\n            case \"r\": return new rook_1.Rook(char);\n            case \"h\": return new horse_1.Horse(char);\n            case \"e\": return new elephant_1.Elephant(char);\n            case \"a\": return new adviser_1.Adviser(char);\n            case \"g\": return new general_1.General(char);\n            case \".\": return piece_1.No.piece;\n        }\n        throw new Error(\"unknown piece: \" + char);\n    };\n    Board.prototype.findOccupiedSquares = function (color) {\n        var squares = [];\n        for (var _i = 0, _a = this.grid; _i < _a.length; _i++) {\n            var row = _a[_i];\n            for (var _b = 0, row_2 = row; _b < row_2.length; _b++) {\n                var square = row_2[_b];\n                if (square.isOccupied() && square.isColor(color)) {\n                    squares.push(square);\n                }\n            }\n        }\n        return squares;\n    };\n    Board.prototype.findGeneral = function (color) {\n        for (var _i = 0, _a = this.grid; _i < _a.length; _i++) {\n            var row = _a[_i];\n            for (var _b = 0, row_3 = row; _b < row_3.length; _b++) {\n                var square = row_3[_b];\n                if (square.isOccupied() && square.isColor(color) && square.getPiece() instanceof general_1.General) {\n                    return square;\n                }\n            }\n        }\n        // This will not happen since the generals cannot be captured\n        throw new Error();\n    };\n    Board.prototype.init = function (state) {\n        for (var y_1 = 0; y_1 < 10; y_1++) {\n            var row = [];\n            for (var x_1 = 0; x_1 < 9; x_1++) {\n                row.push(new square_1.Square(this, x_1, y_1));\n            }\n            this.grid.push(row);\n        }\n        var cleanedState = state.replace(/[^scrheag.]/ig, \"\");\n        if (cleanedState.length !== 90) {\n            throw new Error(\"invalid state: \" + cleanedState + \", expected to contain 90 chars\");\n        }\n        var x = 0, y = 0;\n        for (var _i = 0, cleanedState_1 = cleanedState; _i < cleanedState_1.length; _i++) {\n            var char = cleanedState_1[_i];\n            this.grid[y][x].setPiece(Board.createPiece(char));\n            x++;\n            if (x > 8) {\n                x = 0;\n                y++;\n            }\n        }\n    };\n    Board.beginState = \"r h e a g a e h r\\n         . . . . . . . . .\\n         . c . . . . . c .\\n         s . s . s . s . s\\n         . . . . . . . . .\\n         . . . . . . . . .\\n         S . S . S . S . S\\n         . C . . . . . C .\\n         . . . . . . . . .\\n         R H E A G A E H R\";\n    return Board;\n}());\nexports.Board = Board;\n\n\n//# sourceURL=webpack://xi/./src/game/board.ts?");

/***/ }),

/***/ "./src/game/cannon.ts":
/*!****************************!*\
  !*** ./src/game/cannon.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Cannon = /** @class */ (function (_super) {\n    __extends(Cannon, _super);\n    function Cannon(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    Cannon.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        Cannon.addSquares(squares, position.getSquares(direction_1.Direction.Up, 2), position.getPiece().color);\n        Cannon.addSquares(squares, position.getSquares(direction_1.Direction.Right, 2), position.getPiece().color);\n        Cannon.addSquares(squares, position.getSquares(direction_1.Direction.Down, 2), position.getPiece().color);\n        Cannon.addSquares(squares, position.getSquares(direction_1.Direction.Left, 2), position.getPiece().color);\n        return squares; //.filter(x => !x.isOccupied() || x.getPiece().color !== position.getPiece().color);\n    };\n    Cannon.addSquares = function (allSquares, squaresToAdd, color) {\n        // First add all unoccupied squares up until the first occupied square\n        for (var _i = 0, squaresToAdd_1 = squaresToAdd; _i < squaresToAdd_1.length; _i++) {\n            var square = squaresToAdd_1[_i];\n            if (square.isOccupied())\n                break;\n            allSquares.push(square);\n        }\n        var occupyingSquares = squaresToAdd.filter(function (x) { return x.isOccupied(); }).length;\n        if (occupyingSquares < 2) {\n            return;\n        }\n        var lastSquare = squaresToAdd[squaresToAdd.length - 1];\n        if (lastSquare.getPiece().color !== color) {\n            // The 2nd occupying square is the opponent's color: ad it to the list\n            allSquares.push(lastSquare);\n        }\n    };\n    return Cannon;\n}(piece_1.Piece));\nexports.Cannon = Cannon;\n\n\n//# sourceURL=webpack://xi/./src/game/cannon.ts?");

/***/ }),

/***/ "./src/game/color.ts":
/*!***************************!*\
  !*** ./src/game/color.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Color;\n(function (Color) {\n    Color[\"Red\"] = \"red\";\n    Color[\"Black\"] = \"black\";\n    Color[\"None\"] = \"none\";\n})(Color = exports.Color || (exports.Color = {}));\n(function (Color) {\n    function opposite(color) {\n        if (color === Color.None) {\n            throw new Error(\"'Color.None' does not have an opposite color\");\n        }\n        return color === Color.Red ? Color.Black : Color.Red;\n    }\n    Color.opposite = opposite;\n})(Color = exports.Color || (exports.Color = {}));\n\n\n//# sourceURL=webpack://xi/./src/game/color.ts?");

/***/ }),

/***/ "./src/game/direction.ts":
/*!*******************************!*\
  !*** ./src/game/direction.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar color_1 = __webpack_require__(/*! ./color */ \"./src/game/color.ts\");\nvar Direction;\n(function (Direction) {\n    Direction[\"Up\"] = \"up\";\n    Direction[\"Right\"] = \"right\";\n    Direction[\"Down\"] = \"down\";\n    Direction[\"Left\"] = \"left\";\n})(Direction = exports.Direction || (exports.Direction = {}));\n(function (Direction) {\n    function dX(direction, color) {\n        if (color === color_1.Color.None) {\n            throw new Error(\"cannot calculate delta x of an unoccupied square\");\n        }\n        switch (direction) {\n            case Direction.Left:\n                return color === color_1.Color.Red ? -1 : 1;\n            case Direction.Right:\n                return color === color_1.Color.Red ? 1 : -1;\n            default:\n                // `Up` and `Down` don't change for `x`\n                return 0;\n        }\n    }\n    Direction.dX = dX;\n    function dY(direction, color) {\n        if (color === color_1.Color.None) {\n            throw new Error(\"cannot calculate delta y of an unoccupied square\");\n        }\n        switch (direction) {\n            case Direction.Up:\n                return color === color_1.Color.Red ? -1 : 1;\n            case Direction.Down:\n                return color === color_1.Color.Red ? 1 : -1;\n            default:\n                // `Left` and `Right` don't change for `y`\n                return 0;\n        }\n    }\n    Direction.dY = dY;\n})(Direction = exports.Direction || (exports.Direction = {}));\n\n\n//# sourceURL=webpack://xi/./src/game/direction.ts?");

/***/ }),

/***/ "./src/game/elephant.ts":
/*!******************************!*\
  !*** ./src/game/elephant.ts ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Elephant = /** @class */ (function (_super) {\n    __extends(Elephant, _super);\n    function Elephant(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    Elephant.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        if (position.isSquare(direction_1.Direction.Up, direction_1.Direction.Left) && !position.getSquare(direction_1.Direction.Up, direction_1.Direction.Left).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up, direction_1.Direction.Up, direction_1.Direction.Left, direction_1.Direction.Left);\n        }\n        if (position.isSquare(direction_1.Direction.Up, direction_1.Direction.Right) && !position.getSquare(direction_1.Direction.Up, direction_1.Direction.Right).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up, direction_1.Direction.Up, direction_1.Direction.Right, direction_1.Direction.Right);\n        }\n        if (position.isSquare(direction_1.Direction.Down, direction_1.Direction.Left) && !position.getSquare(direction_1.Direction.Down, direction_1.Direction.Left).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down, direction_1.Direction.Down, direction_1.Direction.Left, direction_1.Direction.Left);\n        }\n        if (position.isSquare(direction_1.Direction.Down, direction_1.Direction.Right) && !position.getSquare(direction_1.Direction.Down, direction_1.Direction.Right).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down, direction_1.Direction.Down, direction_1.Direction.Right, direction_1.Direction.Right);\n        }\n        return squares\n            .filter(function (x) { return !x.isOverTheRiver(position.getPiece().color); })\n            .filter(function (x) { return !x.isOccupied() || x.getPiece().color !== position.getPiece().color; });\n    };\n    return Elephant;\n}(piece_1.Piece));\nexports.Elephant = Elephant;\n\n\n//# sourceURL=webpack://xi/./src/game/elephant.ts?");

/***/ }),

/***/ "./src/game/general.ts":
/*!*****************************!*\
  !*** ./src/game/general.ts ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar General = /** @class */ (function (_super) {\n    __extends(General, _super);\n    function General(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    General.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up);\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Right);\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down);\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Left);\n        return squares\n            .filter(function (x) { return x.isInOwnCastle(position.getPiece().color); })\n            .filter(function (x) { return !x.isOccupied() || x.getPiece().color !== position.getPiece().color; });\n    };\n    return General;\n}(piece_1.Piece));\nexports.General = General;\n\n\n//# sourceURL=webpack://xi/./src/game/general.ts?");

/***/ }),

/***/ "./src/game/horse.ts":
/*!***************************!*\
  !*** ./src/game/horse.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Horse = /** @class */ (function (_super) {\n    __extends(Horse, _super);\n    function Horse(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    Horse.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        if (position.isSquare(direction_1.Direction.Up) && !position.getSquare(direction_1.Direction.Up).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up, direction_1.Direction.Up, direction_1.Direction.Left);\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up, direction_1.Direction.Up, direction_1.Direction.Right);\n        }\n        if (position.isSquare(direction_1.Direction.Right) && !position.getSquare(direction_1.Direction.Right).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Right, direction_1.Direction.Right, direction_1.Direction.Up);\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Right, direction_1.Direction.Right, direction_1.Direction.Down);\n        }\n        if (position.isSquare(direction_1.Direction.Down) && !position.getSquare(direction_1.Direction.Down).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down, direction_1.Direction.Down, direction_1.Direction.Left);\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Down, direction_1.Direction.Down, direction_1.Direction.Right);\n        }\n        if (position.isSquare(direction_1.Direction.Left) && !position.getSquare(direction_1.Direction.Left).isOccupied()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Left, direction_1.Direction.Left, direction_1.Direction.Up);\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Left, direction_1.Direction.Left, direction_1.Direction.Down);\n        }\n        return squares.filter(function (x) { return !x.isOccupied() || x.getPiece().color !== position.getPiece().color; });\n    };\n    return Horse;\n}(piece_1.Piece));\nexports.Horse = Horse;\n\n\n//# sourceURL=webpack://xi/./src/game/horse.ts?");

/***/ }),

/***/ "./src/game/move.ts":
/*!**************************!*\
  !*** ./src/game/move.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar color_1 = __webpack_require__(/*! ./color */ \"./src/game/color.ts\");\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\n/**\n * The book The Chess of China describes a move notation method in which the ranks\n * of the board are numbered 1 to 10 from closest to farthest away, followed by a\n * digit 1 to 9 for files from right to left. Both values are relative to the moving\n * player. Moves are then indicated as follows:\n *\n *   [piece name] ([former rank][former file])-[new rank][new file]\n *\n * Thus, the most common opening in the game would be written as:\n *\n *   炮 (32)–35   馬 (18)–37\n */\nvar Move = /** @class */ (function () {\n    function Move(from, to) {\n        this.captured = piece_1.No.piece;\n        this.color = from.getPiece().color;\n        if (!from.isOccupied()) {\n            throw new Error(\"invalid move for \" + this.color + \": \" + from.str(this.color) + \" is not occupied\");\n        }\n        this.from = from;\n        this.to = to;\n        this.fromRank = from.getRank(this.color);\n        this.fromFile = from.getFile(this.color);\n        this.toRank = to.getRank(this.color);\n        this.toFile = to.getFile(this.color);\n        this.moveStr = this.from.getPiece().charChinese + \" (\" + this.from.str(this.color) + \")-\" + this.to.str(this.color);\n        this.moveStrSimple = this.from.getPiece().charWestern + \" (\" + this.from.str(this.color) + \")-\" + this.to.str(this.color);\n    }\n    Move.create = function (move, board) {\n        var matches = /^\\s*?([^\\s])\\s*\\(\\s*(\\d\\d?)\\s*(\\d)\\s*\\)\\s*-\\s*(\\d\\d?)\\s*(\\d)\\s*$/.exec(move);\n        if (matches === null || matches.length !== 6) {\n            throw new Error(\"could not parse move: \" + move);\n        }\n        var color = piece_1.Piece.getColor(matches[1]);\n        var fromRank = parseInt(matches[2]);\n        var fromFile = parseInt(matches[3]);\n        var toRank = parseInt(matches[4]);\n        var toFile = parseInt(matches[5]);\n        var from = Move.getSquare(fromRank, fromFile, color, board);\n        var to = Move.getSquare(toRank, toFile, color, board);\n        return new Move(from, to);\n    };\n    /*\n           (i)     0 1 2 3 4 5 6 7 8 (x)\n\n               (B) 1 2 3 4 5 6 7 8 9\n            0   1  . . . . . . . . . 10\n            1   2  . . . . . . . . .  9\n            2   3  . . . . . . . . .  8\n            3   4  . . . . . . . . .  7\n            4   5  . . . . . . . . .  6\n            5   6  . . . . . . . . .  5\n            6   7  . . . . . . . . .  4\n            7   8  . . . . . . . . .  3\n            8   9  . . . . . . . . .  2\n            9  10  . . . . . . . . .  1\n           (y)     9 8 7 6 5 4 3 2 1 (R)\n    */\n    Move.getSquare = function (rank, file, color, state) {\n        var y = color === color_1.Color.Red ? 10 - rank : rank - 1;\n        var x = color === color_1.Color.Red ? 9 - file : file - 1;\n        return state.getSquare(x, y);\n    };\n    return Move;\n}());\nexports.Move = Move;\n\n\n//# sourceURL=webpack://xi/./src/game/move.ts?");

/***/ }),

/***/ "./src/game/piece.ts":
/*!***************************!*\
  !*** ./src/game/piece.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar color_1 = __webpack_require__(/*! ./color */ \"./src/game/color.ts\");\nvar Piece = /** @class */ (function () {\n    function Piece(charWestern) {\n        this.color = Piece.getColor(charWestern);\n        this.charWestern = charWestern;\n        this.charChinese = Piece.charsMap[charWestern];\n    }\n    Piece.prototype.safeAdd = function (squares, position) {\n        var direction = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            direction[_i - 2] = arguments[_i];\n        }\n        if (position.isSquare.apply(position, direction)) {\n            squares.push(position.getSquare.apply(position, direction));\n        }\n    };\n    Piece.prototype.toString = function () {\n        return this.charWestern;\n    };\n    Piece.getColor = function (char) {\n        if (\"SCRHEAG兵炮俥傌相仕帥\".indexOf(char) >= 0)\n            return color_1.Color.Red;\n        if (\"scrheag卒砲車馬象士將\".indexOf(char) >= 0)\n            return color_1.Color.Black;\n        return color_1.Color.None;\n    };\n    Piece.isValidPieceChar = function (char) {\n        return Piece.charsMap[char] !== undefined;\n    };\n    Piece.charsMap = {\n        \"S\": \"兵\", \"C\": \"炮\", \"R\": \"俥\", \"H\": \"傌\", \"E\": \"相\", \"A\": \"仕\", \"G\": \"帥\",\n        \"s\": \"卒\", \"c\": \"砲\", \"r\": \"車\", \"h\": \"馬\", \"e\": \"象\", \"a\": \"士\", \"g\": \"將\" // black chars\n    };\n    return Piece;\n}());\nexports.Piece = Piece;\nvar No = /** @class */ (function (_super) {\n    __extends(No, _super);\n    function No(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    No.prototype.getAttackingSquares = function (position) {\n        throw new Error(\"cannot get attacking squares for `No.piece`\");\n    };\n    No.piece = new No(\".\");\n    return No;\n}(Piece));\nexports.No = No;\n\n\n//# sourceURL=webpack://xi/./src/game/piece.ts?");

/***/ }),

/***/ "./src/game/rook.ts":
/*!**************************!*\
  !*** ./src/game/rook.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Rook = /** @class */ (function (_super) {\n    __extends(Rook, _super);\n    function Rook(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    Rook.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        squares = squares.concat(position.getSquares(direction_1.Direction.Up));\n        squares = squares.concat(position.getSquares(direction_1.Direction.Right));\n        squares = squares.concat(position.getSquares(direction_1.Direction.Down));\n        squares = squares.concat(position.getSquares(direction_1.Direction.Left));\n        return squares.filter(function (x) { return !x.isOccupied() || x.getPiece().color !== position.getPiece().color; });\n    };\n    return Rook;\n}(piece_1.Piece));\nexports.Rook = Rook;\n\n\n//# sourceURL=webpack://xi/./src/game/rook.ts?");

/***/ }),

/***/ "./src/game/soldier.ts":
/*!*****************************!*\
  !*** ./src/game/soldier.ts ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Soldier = /** @class */ (function (_super) {\n    __extends(Soldier, _super);\n    function Soldier(charWestern) {\n        return _super.call(this, charWestern) || this;\n    }\n    Soldier.prototype.getAttackingSquares = function (position) {\n        var squares = [];\n        _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Up);\n        if (position.isOverTheRiver()) {\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Left);\n            _super.prototype.safeAdd.call(this, squares, position, direction_1.Direction.Right);\n        }\n        return squares.filter(function (x) { return !x.isOccupied() || x.getPiece().color !== position.getPiece().color; });\n    };\n    return Soldier;\n}(piece_1.Piece));\nexports.Soldier = Soldier;\n\n\n//# sourceURL=webpack://xi/./src/game/soldier.ts?");

/***/ }),

/***/ "./src/game/square.ts":
/*!****************************!*\
  !*** ./src/game/square.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar color_1 = __webpack_require__(/*! ./color */ \"./src/game/color.ts\");\nvar piece_1 = __webpack_require__(/*! ./piece */ \"./src/game/piece.ts\");\nvar direction_1 = __webpack_require__(/*! ./direction */ \"./src/game/direction.ts\");\nvar Square = /** @class */ (function () {\n    function Square(board, x, y) {\n        this.piece = piece_1.No.piece;\n        this.board = board;\n        this.x = x;\n        this.y = y;\n    }\n    Square.prototype.isSquare = function () {\n        var directions = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            directions[_i] = arguments[_i];\n        }\n        var nextXY = this.getNextXY.apply(this, directions);\n        return Square.inBounds(nextXY[0], nextXY[1]);\n    };\n    Square.prototype.getSquare = function () {\n        var directions = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            directions[_i] = arguments[_i];\n        }\n        if (!this.isSquare.apply(this, directions)) {\n            throw new Error(\"no neighbor \" + directions + \" from x=\" + this.x + \", y=\" + this.y);\n        }\n        var nextXY = this.getNextXY.apply(this, directions);\n        return this.board.getSquare(nextXY[0], nextXY[1]);\n    };\n    Square.prototype.getSquares = function (direction, includeAmountOfPieces) {\n        if (includeAmountOfPieces === void 0) { includeAmountOfPieces = 1; }\n        var squares = [];\n        var amountOfPieces = 0;\n        var nextX = this.x + direction_1.Direction.dX(direction, this.piece.color);\n        var nextY = this.y + direction_1.Direction.dY(direction, this.piece.color);\n        while (Square.inBounds(nextX, nextY)) {\n            var square = this.board.getSquare(nextX, nextY);\n            amountOfPieces += square.isOccupied() ? 1 : 0;\n            squares.push(square);\n            nextX += direction_1.Direction.dX(direction, this.piece.color);\n            nextY += direction_1.Direction.dY(direction, this.piece.color);\n            if (amountOfPieces === includeAmountOfPieces) {\n                break;\n            }\n        }\n        return squares;\n    };\n    Square.prototype.isColor = function (color) {\n        return this.getPiece().color === color;\n    };\n    Square.prototype.isOccupied = function () {\n        return this.piece.color !== color_1.Color.None;\n    };\n    Square.prototype.isOverTheRiver = function (color) {\n        if (color === void 0) { color = this.piece.color; }\n        return ((color === color_1.Color.Red) && (this.y <= 4)) || ((color === color_1.Color.Black) && (this.y >= 5));\n    };\n    Square.prototype.isInOwnCastle = function (color) {\n        if (color === void 0) { color = this.piece.color; }\n        return ((color === color_1.Color.Red) && (this.y >= 7) && (this.x >= 3) && (this.x <= 5)) ||\n            ((color === color_1.Color.Black) && (this.y <= 2) && (this.x >= 3) && (this.x <= 5));\n    };\n    Square.prototype.getPiece = function () {\n        return this.piece;\n    };\n    Square.prototype.setPiece = function (newPiece) {\n        if (this.isOccupied() && this.piece.color === newPiece.color) {\n            throw new Error(\"cannot move \" + newPiece.charWestern + \" to (\" + this.getNotation(newPiece.color) + \"): already occupied by \" + this.piece.charWestern);\n        }\n        var possiblyCaptured = this.piece;\n        this.piece = newPiece;\n        return possiblyCaptured;\n    };\n    Square.prototype.getNotation = function (color) {\n        return \"\" + this.getRank(color) + this.getFile(color);\n    };\n    // index  red  black\n    // 0      9    1\n    // 1      8    2\n    // 2      7    3\n    // 3      6    4\n    // 4      5    5\n    // 5      4    6\n    // 6      3    7\n    // 7      2    8\n    // 8      1    9\n    Square.prototype.getFile = function (color) {\n        return color === color_1.Color.Red ? 9 - this.x : 1 + this.x;\n    };\n    // index  red  black\n    // 0      10   1\n    // 1      9    2\n    // 2      8    3\n    // 3      7    4\n    // 4      6    5\n    // 5      5    6\n    // 6      4    7\n    // 7      3    8\n    // 8      2    9\n    // 9      1    10\n    Square.prototype.getRank = function (color) {\n        return color === color_1.Color.Red ? 10 - this.y : 1 + this.y;\n    };\n    Square.prototype.str = function (color) {\n        return \"\" + this.getRank(color) + this.getFile(color);\n    };\n    Square.prototype.getNextXY = function () {\n        var directions = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            directions[_i] = arguments[_i];\n        }\n        var newX = this.x;\n        var newY = this.y;\n        for (var _a = 0, directions_1 = directions; _a < directions_1.length; _a++) {\n            var direction = directions_1[_a];\n            newX += direction_1.Direction.dX(direction, this.piece.color);\n            newY += direction_1.Direction.dY(direction, this.piece.color);\n        }\n        return [newX, newY];\n    };\n    Square.inBounds = function (x, y) {\n        return x >= 0 && x <= 8 && y >= 0 && y <= 9;\n    };\n    return Square;\n}());\nexports.Square = Square;\n\n\n//# sourceURL=webpack://xi/./src/game/square.ts?");

/***/ }),

/***/ "./src/ui/main.ts":
/*!************************!*\
  !*** ./src/ui/main.ts ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ui_board_1 = __webpack_require__(/*! ./ui-board */ \"./src/ui/ui-board.ts\");\nfunction load(boardId, movesTableId, redPlayer, blackPlayer, gameId, reversed, moves) {\n    if (moves === void 0) { moves = []; }\n    var boardDiv = document.getElementById(boardId);\n    var movesTable = document.getElementById(movesTableId);\n    var head = movesTable.insertRow();\n    head.insertCell().appendChild(document.createTextNode(\"\"));\n    head.insertCell().appendChild(document.createTextNode(redPlayer));\n    head.insertCell().appendChild(document.createTextNode(blackPlayer));\n    return new ui_board_1.UiBoard(boardDiv, movesTable, gameId, reversed, moves);\n}\nexports.load = load;\n\n\n//# sourceURL=webpack://xi/./src/ui/main.ts?");

/***/ }),

/***/ "./src/ui/ui-board.ts":
/*!****************************!*\
  !*** ./src/ui/ui-board.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar board_1 = __webpack_require__(/*! ../game/board */ \"./src/game/board.ts\");\nvar ui_square_1 = __webpack_require__(/*! ./ui-square */ \"./src/ui/ui-square.ts\");\nvar move_1 = __webpack_require__(/*! ../game/move */ \"./src/game/move.ts\");\nvar color_1 = __webpack_require__(/*! ../game/color */ \"./src/game/color.ts\");\nvar piece_1 = __webpack_require__(/*! ../game/piece */ \"./src/game/piece.ts\");\nvar UiBoard = /** @class */ (function () {\n    function UiBoard(boardDiv, movesTable, gameId, reversed, moves) {\n        if (moves === void 0) { moves = []; }\n        this.possibleMoves = [];\n        this.movesMade = 0;\n        this.boardDiv = boardDiv;\n        this.movesTable = movesTable;\n        this.gameId = gameId;\n        this.reversed = reversed;\n        this.board = new board_1.Board();\n        this.squares = [];\n        this.init(moves);\n    }\n    UiBoard.prototype.getSubmitMoveTitle = function () {\n        return !!this.firstMove ? \"Submit move \" + this.firstMove.moveStr + \"?\" : \"No move made yet\";\n    };\n    UiBoard.prototype.submitMove = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var needsReload, response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.movesMade === 0) {\n                            UiBoard.message(\"no move made yet\");\n                            return [2 /*return*/, false];\n                        }\n                        needsReload = this.movesMade > 1;\n                        while (this.movesMade > 0) {\n                            // Undo all the moves the player made, and make the first move for real by POST-ing it to the backend\n                            this.board.popMove();\n                            this.movesMade--;\n                        }\n                        this.selectedSquare = this.firstSquare;\n                        return [4 /*yield*/, fetch(this.gameId + \"/move/\" + this.firstMove.moveStrSimple, { method: \"POST\", credentials: \"same-origin\" })];\n                    case 1:\n                        response = _a.sent();\n                        if (response.ok) {\n                            this.handle(this.firstMove, this.firstSquare);\n                        }\n                        else {\n                            UiBoard.message(response.statusText);\n                            return [2 /*return*/, false];\n                        }\n                        return [2 /*return*/, needsReload];\n                }\n            });\n        });\n    };\n    UiBoard.prototype.proposeDraw = function () {\n        fetch(this.gameId + \"/propose-draw\", { method: \"POST\", credentials: \"same-origin\" })\n            .then(function (response) {\n            if (!response.ok) {\n                UiBoard.message(response.statusText);\n                return;\n            }\n            UiBoard.message(\"Proposal sent!\");\n        })\n            .catch(function (e) {\n            UiBoard.message(\"Oops: \" + e);\n            console.log('Exception: ', e);\n        });\n    };\n    UiBoard.prototype.forfeitGame = function () {\n        fetch(this.gameId + \"/forfeit\", { method: \"POST\", credentials: \"same-origin\" })\n            .then(function (response) {\n            if (!response.ok) {\n                UiBoard.message(response.statusText);\n                return;\n            }\n            location.reload();\n        })\n            .catch(function (e) {\n            UiBoard.message(\"Oops: \" + e);\n            console.log('Exception: ', e);\n        });\n    };\n    UiBoard.prototype.click = function (uiSquare) {\n        if (!uiSquare.isOccupied() && this.selectedSquare === undefined) {\n            return;\n        }\n        if (this.selectedSquare === undefined && !uiSquare.isColor(this.board.getTurn())) {\n            UiBoard.message(\"it's \" + this.board.getTurn() + \"'s turn\");\n            return;\n        }\n        this.lastMove(false);\n        if (this.selectedSquare === uiSquare) {\n            this.possibleMoves.every(function (x) { return x.paint(); });\n            this.possibleMoves = [];\n            uiSquare.paint();\n            this.selectedSquare = undefined;\n            return;\n        }\n        if (this.selectedSquare === undefined) {\n            this.possibleMoves = this.getAttackingSquares(uiSquare);\n            this.selectedSquare = uiSquare;\n            this.selectedSquare.paint(true);\n            this.possibleMoves.every(function (x) { return x.highlight(); });\n            return;\n        }\n        var move = new move_1.Move(this.selectedSquare.square, uiSquare.square);\n        this.handle(move, uiSquare);\n    };\n    UiBoard.prototype.handle = function (move, uiSquare) {\n        var _this = this;\n        this.movesMade++;\n        if (this.firstMove === undefined) {\n            this.firstMove = move;\n            this.firstSquare = uiSquare;\n        }\n        try {\n            this.move(move);\n            setTimeout(function () {\n                _this.possibleMoves.every(function (x) { return x.paint(); });\n                _this.possibleMoves = [];\n                _this.selectedSquare.paint();\n                uiSquare.paint();\n                _this.selectedSquare = undefined;\n                _this.checkState();\n            }, 50);\n        }\n        catch (e) {\n            UiBoard.message(\"Oops: \" + e);\n        }\n    };\n    UiBoard.prototype.move = function (move) {\n        // First call `board.makeMove(...)` because it might set the captured piece\n        // which is displayed in `addMoveToTable(...)`\n        this.board.makeMove(move);\n        this.addMoveToTable(move);\n    };\n    UiBoard.prototype.checkState = function () {\n        if (this.board.isCheckmate(this.board.getTurn())) {\n            UiBoard.message(this.board.getTurn() + \" is checkmate, \" + color_1.Color.opposite(this.board.getTurn()) + \" wins\");\n        }\n        else if (this.board.isCheck(this.board.getTurn())) {\n            UiBoard.message(this.board.getTurn() + \" is check\");\n        }\n    };\n    UiBoard.prototype.getAttackingSquares = function (from) {\n        var _this = this;\n        return from.getAttackingSquares().map(function (square) { return _this.squares[square.y][square.x]; });\n    };\n    UiBoard.prototype.init = function (moves) {\n        var _this = this;\n        if (moves === void 0) { moves = []; }\n        for (var _i = 0, moves_1 = moves; _i < moves_1.length; _i++) {\n            var move = moves_1[_i];\n            this.move(move_1.Move.create(move, this.board));\n        }\n        var cellDimension = this.boardDiv.offsetWidth / 11;\n        this.insert(this.boardDiv, this.createRowDiv(cellDimension, UiBoard.black, \"\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"\"));\n        for (var y = 0; y < 10; y++) {\n            var rowDiv = this.createRowDiv(cellDimension);\n            this.squares.push([]);\n            var _loop_1 = function (x) {\n                if (x === 0) {\n                    this_1.insert(rowDiv, UiBoard.createDiv(cellDimension, \"\" + (y + 1), UiBoard.black));\n                }\n                var canvas = UiBoard.createCanvas(cellDimension);\n                this_1.insert(rowDiv, canvas);\n                var uiSquare = new ui_square_1.UiSquare(canvas, this_1.board.getSquare(x, y), this_1.reversed);\n                uiSquare.canvas.onmousedown = function () { _this.click(uiSquare); };\n                this_1.squares[y].push(uiSquare);\n                if (x === 8) {\n                    this_1.insert(rowDiv, UiBoard.createDiv(cellDimension, \"\" + (10 - y), UiBoard.red));\n                }\n            };\n            var this_1 = this;\n            for (var x = 0; x < 9; x++) {\n                _loop_1(x);\n            }\n            this.insert(this.boardDiv, rowDiv);\n        }\n        this.insert(this.boardDiv, this.createRowDiv(cellDimension, UiBoard.red, \"\", \"9\", \"8\", \"7\", \"6\", \"5\", \"4\", \"3\", \"2\", \"1\", \"\"));\n        this.lastMove(true);\n        this.checkState();\n    };\n    UiBoard.prototype.lastMove = function (highlight) {\n        if (this.board.moves.length > 0) {\n            var lastMove = this.board.moves[this.board.moves.length - 1];\n            this.possibleMoves.push(this.squares[lastMove.from.y][lastMove.from.x]);\n            this.possibleMoves.push(this.squares[lastMove.to.y][lastMove.to.x]);\n            this.possibleMoves.every(function (x) { return highlight ? x.highlight() : x.paint(); });\n        }\n    };\n    UiBoard.prototype.createRowDiv = function (cellDimension, textColor) {\n        if (textColor === void 0) { textColor = UiBoard.black; }\n        var childDivs = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            childDivs[_i - 2] = arguments[_i];\n        }\n        var rowDiv = document.createElement(\"div\");\n        rowDiv.style.height = cellDimension + \"px\";\n        for (var i = 0; i < childDivs.length; i++) {\n            this.insert(rowDiv, UiBoard.createDiv(cellDimension, childDivs[i], textColor));\n        }\n        return rowDiv;\n    };\n    UiBoard.createDiv = function (cellDimension, text, textColor) {\n        if (textColor === void 0) { textColor = UiBoard.black; }\n        var div = document.createElement(\"div\");\n        div.style.width = cellDimension + \"px\";\n        div.style.height = cellDimension + \"px\";\n        div.innerHTML = text;\n        div.style.textAlign = \"center\";\n        div.style.verticalAlign = \"middle\";\n        div.style.lineHeight = cellDimension + \"px\";\n        div.style.cssFloat = 'left';\n        div.style.position = 'relative';\n        if (textColor !== null) {\n            div.style.fontSize = \"11px\";\n            div.style.fontFamily = \"Sans-serif\";\n            div.style.color = textColor;\n        }\n        return div;\n    };\n    UiBoard.createCanvas = function (cellDimension) {\n        var canvas = document.createElement(\"canvas\");\n        canvas.style.width = cellDimension + \"px\";\n        canvas.style.height = cellDimension + \"px\";\n        canvas.style.cssFloat = 'left';\n        canvas.style.position = 'relative';\n        return canvas;\n    };\n    UiBoard.prototype.addMoveToTable = function (move) {\n        var turn = color_1.Color.opposite(this.board.getTurn());\n        var row;\n        if (turn === color_1.Color.Red) {\n            row = this.movesTable.insertRow();\n            var numberCell = row.insertCell();\n            numberCell.className = \"number-move\";\n            this.insert(numberCell, document.createTextNode(\"\" + (this.movesTable.rows.length - 1)));\n        }\n        else {\n            row = this.movesTable.rows[this.movesTable.rows.length - 1];\n        }\n        var moveCell = row.insertCell();\n        moveCell.className = \"move \" + turn + \"-move\";\n        this.insert(moveCell, document.createTextNode(move.moveStr));\n        if (move.captured !== piece_1.No.piece) {\n            var img = document.createElement('img');\n            img.src = \"/svg/\" + move.captured.charWestern.toLowerCase() + (move.captured.color === color_1.Color.Red ? \"r\" : \"b\") + \".svg\";\n            img.className = \"captured\";\n            this.insert(moveCell, img);\n        }\n    };\n    UiBoard.prototype.insert = function (parent, child) {\n        if (this.reversed) {\n            parent.insertBefore(child, parent.childNodes[0] || null);\n        }\n        else {\n            parent.appendChild(child);\n        }\n    };\n    UiBoard.message = function (message) {\n        var div = document.createElement(\"div\");\n        div.id = \"message\";\n        div.className = \"alert alert-danger alert-dismissible\";\n        var a = document.createElement(\"a\");\n        a.className = \"close\";\n        a.setAttribute(\"data-dismiss\", \"alert\");\n        a.setAttribute(\"aria-label\", \"close\");\n        a.innerHTML = \"&times;\";\n        var span = document.createElement(\"span\");\n        span.innerText = message;\n        div.appendChild(a);\n        div.appendChild(span);\n        document.body.appendChild(div);\n        setTimeout(function () {\n            if (document.body.contains(div)) {\n                document.body.removeChild(div);\n            }\n        }, 5000);\n    };\n    UiBoard.red = \"#CC0000\";\n    UiBoard.black = \"#000000\";\n    return UiBoard;\n}());\nexports.UiBoard = UiBoard;\n\n\n//# sourceURL=webpack://xi/./src/ui/ui-board.ts?");

/***/ }),

/***/ "./src/ui/ui-square.ts":
/*!*****************************!*\
  !*** ./src/ui/ui-square.ts ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar color_1 = __webpack_require__(/*! ../game/color */ \"./src/game/color.ts\");\nvar UiSquare = /** @class */ (function () {\n    function UiSquare(canvas, square, reversed) {\n        this.canvas = canvas;\n        this.square = square;\n        this.reversed = reversed;\n        this.paint(false);\n    }\n    UiSquare.prototype.isColor = function (color) {\n        return this.square.getPiece().color === color;\n    };\n    UiSquare.prototype.isOccupied = function () {\n        return this.square.isOccupied();\n    };\n    UiSquare.prototype.getAttackingSquares = function () {\n        return this.square.getPiece().getAttackingSquares(this.square);\n    };\n    UiSquare.prototype.paint = function (highlight) {\n        if (highlight === void 0) { highlight = false; }\n        this.drawLines();\n        var h = this.canvas.height;\n        var w = this.canvas.width;\n        var ctx = this.canvas.getContext(\"2d\");\n        var scalePieces = 0.92;\n        if (highlight) {\n            this.highlight();\n        }\n        if (this.square.isOccupied()) {\n            var img_1 = new Image();\n            var marginHeight_1 = h * scalePieces;\n            var marginWidth_1 = w * scalePieces;\n            img_1.onload = function () {\n                ctx.drawImage(img_1, marginWidth_1, marginHeight_1, w - (2 * marginWidth_1), h - (2 * marginHeight_1));\n            };\n            img_1.src = \"/svg/\" + this.square.getPiece().charWestern.toLowerCase() + (this.square.getPiece().color === color_1.Color.Red ? \"r\" : \"b\") + \".svg\";\n        }\n        return true;\n    };\n    UiSquare.prototype.highlight = function () {\n        var h = this.canvas.height;\n        var w = this.canvas.width;\n        var ctx = this.canvas.getContext(\"2d\");\n        var gap = 3;\n        ctx.beginPath();\n        ctx.lineWidth = 1.5 * 2.5;\n        ctx.ellipse(w / 2.0, h / 2.0, (w / 2.0) - gap, (h / 2.0) - gap, 0, 0, Math.PI * 2);\n        ctx.stroke();\n        return true;\n    };\n    UiSquare.prototype.drawLines = function () {\n        var ctx = this.canvas.getContext(\"2d\");\n        var h = this.canvas.height;\n        var w = this.canvas.width;\n        ctx.fillStyle = \"white\";\n        ctx.fillRect(0, 0, w, h);\n        ctx.lineWidth = 2.5;\n        ctx.fillStyle = \"#282828\";\n        ctx.strokeStyle = \"#282828\";\n        var x = this.square.x;\n        var y = this.square.y;\n        // 0 degrees\n        if (this.reversed ? x > 0 : x < 8)\n            UiSquare.drawLineSegment(ctx, w, h, w, h / 2.0);\n        // 90 degrees\n        if (this.reversed ?\n            (y < 9 && !UiSquare.isRiver(y === 4, x)) :\n            (y > 0 && !UiSquare.isRiver(y === 5, x)))\n            UiSquare.drawLineSegment(ctx, w, h, w / 2.0, 0);\n        // 180 degrees\n        if (this.reversed ? x < 8 : x > 0)\n            UiSquare.drawLineSegment(ctx, w, h, 0, h / 2.0);\n        // 270 degrees\n        if (this.reversed ?\n            (y > 0 && !UiSquare.isRiver(y === 5, x)) :\n            (y < 9 && !UiSquare.isRiver(y === 4, x)))\n            UiSquare.drawLineSegment(ctx, w, h, w / 2.0, h);\n        // 45 degrees\n        if (this.reversed ?\n            ((y === 1 && x === 4) || (y === 7 && x === 5) || (y === 8 && x === 4) || (y === 0 && x === 5)) :\n            ((y === 1 && x === 4) || (y === 2 && x === 3) || (y === 8 && x === 4) || (y === 9 && x === 3)))\n            UiSquare.drawLineSegment(ctx, w, h, w, 0);\n        // 135 degrees\n        if (this.reversed ?\n            ((y === 0 && x === 3) || (y === 1 && x === 4) || (y === 7 && x === 3) || (y === 8 && x === 4)) :\n            ((y === 1 && x === 4) || (y === 2 && x === 5) || (y === 8 && x === 4) || (y === 9 && x === 5)))\n            UiSquare.drawLineSegment(ctx, w, h, 0, 0);\n        // 225 degrees\n        if (this.reversed ?\n            ((y === 1 && x === 4) || (y === 2 && x === 3) || (y === 8 && x === 4) || (y === 9 && x === 3)) :\n            ((y === 0 && x === 5) || (y === 1 && x === 4) || (y === 7 && x === 5) || (y === 8 && x === 4)))\n            UiSquare.drawLineSegment(ctx, w, h, 0, h);\n        // 315 degrees\n        if (this.reversed ?\n            ((y === 1 && x === 4) || (y === 2 && x === 5) || (y === 8 && x === 4) || (y === 9 && x === 5)) :\n            ((y === 0 && x === 3) || (y === 1 && x === 4) || (y === 7 && x === 3) || (y === 8 && x === 4)))\n            UiSquare.drawLineSegment(ctx, w, h, w, h);\n        // Cannon and soldier markers\n        if (((y === 2 || y === 7) && (x === 1 || x == 7)) || ((y === 3 || y === 6) && (x === 2 || x == 4 || x == 6))) {\n            UiSquare.drawMarker(ctx, w, h, 1);\n            UiSquare.drawMarker(ctx, w, h, 2);\n            UiSquare.drawMarker(ctx, w, h, 3);\n            UiSquare.drawMarker(ctx, w, h, 4);\n        }\n        if ((y === 3 || y === 6) && (this.reversed ? x === 8 : x === 0)) {\n            UiSquare.drawMarker(ctx, w, h, 1);\n            UiSquare.drawMarker(ctx, w, h, 2);\n        }\n        if ((y === 3 || y === 6) && (this.reversed ? x === 0 : x === 8)) {\n            UiSquare.drawMarker(ctx, w, h, 3);\n            UiSquare.drawMarker(ctx, w, h, 4);\n        }\n    };\n    UiSquare.drawLineSegment = function (ctx, totalWidth, totalHeight, toWidth, toHeight) {\n        ctx.beginPath();\n        ctx.moveTo(totalWidth / 2.0, totalHeight / 2.0);\n        ctx.lineTo(toWidth, toHeight);\n        ctx.stroke();\n    };\n    UiSquare.drawMarker = function (ctx, totalWidth, totalHeight, quadrant) {\n        var scale = 25;\n        var sizeWidth = totalWidth / scale;\n        var sizeHeight = totalHeight / scale;\n        if (quadrant === 1)\n            ctx.fillRect((totalWidth / 2.0) + sizeWidth, (totalHeight / 2.0) - (2 * sizeHeight), sizeWidth, sizeHeight);\n        else if (quadrant === 2)\n            ctx.fillRect((totalWidth / 2.0) + sizeWidth, (totalHeight / 2.0) + sizeHeight, sizeWidth, sizeHeight);\n        else if (quadrant === 3)\n            ctx.fillRect((totalWidth / 2.0) - (2 * sizeWidth), (totalHeight / 2.0) + sizeHeight, sizeWidth, sizeHeight);\n        else\n            ctx.fillRect((totalWidth / 2.0) - (2 * sizeWidth), (totalHeight / 2.0) - (2 * sizeHeight), sizeWidth, sizeHeight);\n    };\n    UiSquare.isRiver = function (isRiverRank, x) {\n        return isRiverRank && x > 0 && x < 8;\n    };\n    return UiSquare;\n}());\nexports.UiSquare = UiSquare;\n\n\n//# sourceURL=webpack://xi/./src/ui/ui-square.ts?");

/***/ })

/******/ });